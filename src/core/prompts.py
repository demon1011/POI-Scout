###压缩网页内容
def compress_web(context, max_input_len=120000, max_output_len=50000):
    """
    生成网页内容压缩的 prompt

    Args:
        context: 网页内容
        max_input_len: 输入内容最大长度，超过则截断（默认12000字符）
        max_output_len: 压缩结果最大长度，超过则截断（默认50000字符）

    Returns:
        (prompt, max_output_len) 元组
    """
    # 如果输入超过 max_input_len，截断保留前面的内容
    if len(context) > max_input_len:
        context = context[:max_input_len] + "\n...(内容过长已截断)"

    prompt='''请根据用户的任务请求对以下网页搜索内容进行摘抄。
【任务请求】
搜索与旅游相关的POI名称，介绍以及评价等所有相关内容。
【网页内容】
%s

------------------------
现在请基于"搜索与旅游相关的POI名称，介绍以及评价等所有相关内容。"的请求，对以上网页内容进行摘抄和压缩。
注意：
-输出结果中的内容需要与【任务请求】相关，去掉无关的信息和内容；
-请在输出结果中摘抄【网页内容】的原文，不要对【网页内容】进行任何信息或内容的补充;
'''%(context)
    return prompt, max_output_len

def search_plan_prompt(user_query):
    prompt='''你是一个旅行规划agent，你需要根据用户请求设计一个搜索计划，使用搜索工具来搜索多个候选POI，以供后续筛选匹配用户需求。
-你可以规划多个主题来使用搜索工具搜索POI，确定主题之后有搜索agent从网上搜索请求对应的POI、简介以及评价；
-你的搜索计划中，最多可以确定5个搜索请求进行搜索；
-每一个搜索请求中，你需要基于行动规划详细描述需要搜索的信息，而不是仅仅提供搜索关键词；
-最终将按照以下标准判断候选POI搜索结果的质量：1.搜索出来的尽量多的候选POI；2.每个候选POI都必须与用户的请求相关；3.对每个POI都有尽量多的多方面评价，既有好评又有差评。
【用户请求】
%s

------------------------
请按照以下格式输出你的搜索计划,注意你的搜索计划中不要有别的内容。
[{
"行动步骤":"1"
"行动规划":"xxxx",
"搜索请求":"xxxx"
},
{
"行动步骤":"2"
"行动规划":"xxxx",
"搜索请求":"xxxx"
},
...(最多5步)
]
    '''%(user_query)
    return prompt

def search_opt_plan_prompt(user_query,advice=''):
    prompt='''你是一个旅行规划agent，你需要根据用户请求设计一个搜索计划，使用搜索工具来搜索多个候选POI，以供后续筛选匹配用户需求。
-你可以规划多个主题来使用搜索工具搜索POI，确定主题之后有搜索agent从网上搜索请求对应的POI、简介以及评价；
-你的搜索计划中，最多可以确定5个搜索请求进行搜索；
-每一个搜索请求中，你需要基于行动规划详细描述需要搜索的信息，而不是仅仅提供搜索关键词；
-最终将按照以下标准判断候选POI搜索结果的质量：1.搜索出来的尽量多的候选POI；2.每个候选POI都必须与用户的请求相关；

【用户请求】
%s
【规划建议】
%s

------------------------
请按照以下格式输出你的搜索计划,注意你的搜索计划中不要有别的内容。
[{
"行动步骤":"1"
"行动规划":"xxxx",
"搜索请求":"xxxx"
},
{
"行动步骤":"2"
"行动规划":"xxxx",
"搜索请求":"xxxx"
},
...(最多5步)
]
    '''%(user_query,advice)
    return prompt

def poi_parse_prompt(content):
    prompt='''你是一个旅行规划助手，现在需要根据搜索记录的内容整理总结所有其中提到的旅行POI名称、简介、好评以及差评内容。
注意：
-POI名称和POI简介必须从搜索记录的内容中摘抄或总结得出，你不能补充或创造；
-好评和差评内容只能摘取搜索记录中的内容，并且每一条好评或差评都必须与对应的POI相关；
-所有的好评，差评最后以列表的形式放在输出结果中；
【搜索记录】
%s

------------------------
请确保输出内容的结尾是严格按照下面list格式输出的结果，而不是任何中间思考过程。
[{
    "POI名称":"笔记中提到的POI名称",
    "POI简介":"xxxxxx",
    "好评内容":["xxx","xxx"],
    "差评内容":["xxx","xxx"]
},
{
    "POI名称":"笔记中提到的POI名称",
    "POI简介":"xxxxxx",
    "好评内容":["xxx","xxx"],
    "差评内容":["xxx","xxx"]
},
...]
'''%(content)
    return prompt

def agent_match_prompt(user_query,poi_info):
    prompt='''你是一个旅行助手agent,请根据用户请求，和poi信息，判断该poi是否可能与用户请求相匹配。注意:
-为了提高筛选结果的召回率，只要有可能匹配用户需求的poi都应该判断为"是"，完全不匹配的poi或内容才应该被判断为"否";
    
【用户请求】
%s
【poi信息】
%s

------------------------
判断结果请按照以下格式给出，输出结果中不要包含其他内容。
{
"可能匹配":"是/否"，
"判断理由":"xxxxxx"
}   
'''%(user_query,poi_info)
    return prompt
def troubleshoot_prompt(user_query,cur_log,criteria):
    prompt='''你是一个旅行计划规划专家，现在有一个使用社交平台工具搜索候选POI的搜索计划和执行结果。请你根据搜索候选POI的评判标准，选出当前执行计划中最值得改进的步骤。注意:
-请基于评判标准和执行结果，通过逻辑推理得出最需要改进的步骤，并且给出当前的问题；
-按重要性，请选择最多1个步骤及其问题；
    
【用户请求】
%s
【评判标准】
%s
【搜索计划及执行结果】
%s
------------------------
请以以下格式输出你的改进建议。
[{
"行动步骤":"1/2/..."(搜索计划中需要改进的步骤),
"当前问题":"xxxx"(根据评判标准，该步骤当前需要改进的最大问题是什么)
}
...(最多1条)
]
    
    '''%(user_query,criteria,cur_log)
    return prompt

def refine_prompt(search_content,problem,cur_step_plan):
    prompt='''你是一个旅行计划规划专家，现在有一个使用社交平台工具搜索候选POI的搜索计划和执行结果。现在有一个搜索计划和搜索过程的记录，请你根据该计划的搜索记录和当前问题，给出修改搜索计划的改进建议。
-你的修改建议是针对搜索计划提出的，尤其是搜索计划的行动规划和搜索请求，搜索请求将作为输入提供给agent执行新的搜索过程，直接对搜索过程产生影响；
【搜索计划】
%s
【搜索过程】
%s
【当前问题】
%s

------------------
请按照以下格式给出你的结果,不要输出其他内容。
{
"修改建议":"xxxxxx"
}
'''%(cur_step_plan,search_content,problem)
    return prompt

def new_step_prompt(user_query,cur_step,advice):
    prompt='''你是一个旅行计划规划专家，现在有一个使用社交平台工具搜索候选POI的搜索计划，我们对当前搜索计划的某一步骤提出了改进建议，请你根据改进建议生成新的搜索计划步骤。注意:
-请检查每条改进建议的理由是否符合逻辑，如果存在严重逻辑错误的建议可以忽略；
-搜索请求中的内容会传入搜索工具中改变工作结果，因此请在搜索请求的内容中体现改进建议的思路,并且要详细体现搜索所需的必要信息，而不仅仅是关键词；

【用户请求】
%s
【当前步骤】
%s
【改进建议】
%s
------------------------
请按照以下格式输出改进后的搜索计划,注意你的搜索计划中不要有别的内容。
{
"行动步骤":"x",(与当前步骤中一致)
"行动规划":"xxxx",
"搜索请求":"xxxx"(基于改进建议，搜索请求的内容应该所有改变)
}  
    '''%(user_query,cur_step,advice)
    return prompt

def new_sample_prompt(user_query,cur_plan):
    prompt='''你是一个旅行计划规划专家，现在有一个使用社交平台工具搜索候选POI的搜索计划，请参考当前的搜索计划，生成1个补充的搜索计划步骤。注意:
-最终将按照以下标准判断候选POI搜索结果的质量：1.搜索出来的尽量多的候选POI；2.每个候选POI都必须与用户的请求相关；3.对每个POI都有尽量多的多方面评价，既有好评又有差评。
-新步骤的主题需要匹配用户的请求，同时尽量不要与已有计划的其他步骤的主题重复,以提高整个搜索计划的覆盖度；

【用户请求】
%s
【当前计划】
%s
------------------------
请按照以下格式输出补充的搜索步骤,注意你的输出结果中不要有别的内容。
{
"行动步骤":"x",
"行动规划":"xxxx",
"搜索请求":"xxxx"
}  
    '''%(user_query,cur_plan)
    return prompt

def experience_analysis_prompt(user_query,plan,opt_plan):
    prompt='''你是一个旅行规划专家，现在需要根据用户请求从网上搜集POI，有两份基于用户请求设计及改进后的搜索计划及执行结果，请你对比改进前后的搜索计划及执行结果，总结出设计这类搜索计划的任务的经验，以便以后在同类任务重使用。
-你的经验主要面向行动规划和搜索请求应该如何撰写来总结，其中搜索请求会直接传递给执行agent，从而影响执行结果；
-对于每一条经验的适用POI类别，也在改进意见中给出
-对比方式基于以下标准判断候选POI搜索结果的质量：1.搜索出来的尽量多的候选POI；2.每个候选POI都必须与用户的请求相关；
-对于每一条经验，请给出经验的同时从两份计划中摘抄内容以支持你的经验；
-为了保证可复用性，经验内容中不要有任何具体的地点名；
-你的经验最多不超过3条；
【用户请求】
%s
【原始计划】
%s
【改进后计划】
%s

---------------------
请以以下格式输出你的改进建议，不要输出其他内容。
[{
"POI类别":"xxxx",(经验适用的POI类别)
"经验总结":"xxxx"(经验总结内容,不要包含任何具体的地点名),
"总结理由":"xxxx"(两份计划中相关的内容及总结得到该经验的原因)
},
{
"POI类别":"xxxx",
"经验总结":"xxxx",
"总结理由":"xxxx"
}
...(最多3条)
]
    '''%(user_query,plan,opt_plan)
    return prompt